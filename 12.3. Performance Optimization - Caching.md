# Snowflake Performance Optimization - Caching

## Introduction
Caching in Snowflake is a crucial aspect of performance optimization. It helps in reducing query response times and improving overall efficiency by storing and reusing the results of previous queries.

## Types of Cache in Snowflake
Snowflake utilizes several types of caches to optimize performance:
- Query Result Cache
- Metadata Cache
- Virtual Warehouse Cache

## 1. Query Result Cache
The Query Result Cache stores the results of queries executed in the past 24 hours. If the same query is executed again, Snowflake retrieves the results from the cache instead of re-executing the query.

### 1.1 Query Result Cache Expiry
- The cached results expire after 24 hours. Additionally, any changes to the underlying data will invalidate the cache.
- The result cache expiry is extended up to a maximum of 31 days from the date and time the query was first executed. After 31 days, the result cache is purged and the next time the query is submitted, a new result cache is generated and persisted.

## 2. Metadata Cache
Snowflake stores certain information about each table like row count, min/max values of a column in its metadata in the cloud services layer so that certain queries about the table can be easily answered without reading the table data. This table information stored in metadata is referred as Metadata Cache in Snowflake.

### 2.1 Metadata Cache Expiry
- Every time when data in table is either inserted, updated or deleted, new micro partitions are written and Snowflake keeps track of these changes in the metadata. 
- Hence latest data of above discussed details of a table is always available in the metadata cache.

## 3. Virtual Warehouse Cache
The Virtual Warehouse Cache stores the data that has been recently accessed by the virtual warehouse from the remote disk, reducing the need to read from the storage layer(remote disk).

### 3.1 Virtual Warehouse Cache Expiry
- The cache is cleared when the virtual warehouse is suspended or resized.
- Therefore, it is worth analyzing if suspending a virtual warehouse gives you more cost benefit or keeping it running to have the cache improve query performance.