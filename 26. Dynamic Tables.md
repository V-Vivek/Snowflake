# Dynamic Tables in Snowflake

Dynamic tables in Snowflake are a powerful feature that allows for automatic and incremental updates to table data based on changes in the source data. This feature overcomes some of the limitations associated with standard views and materialized views.

## Overcoming Limitations of Standard Views and Materialized Views

### Standard Views
- **Performance**: Standard views do not store data physically. Every time a query is run against a view, it retrieves data from the underlying tables, which can be slow for complex queries.
- **Real-time Data**: Views always reflect the current state of the underlying tables, which might not be desirable for all use cases.

### Materialized Views
- **Storage**: Materialized views store data physically, which can consume significant storage space.
- **Maintenance**: The data refresh is managed by snowflake and we cannot control it.

## Dynamic Tables
Dynamic tables address these limitations by:
- **Efficient Storage**: They store only the necessary changes, optimizing storage usage.
- **Customizable Refresh Frequency**: The refresh frequency can be controlled using the `TARGET_LAG` parameter, allowing for flexibility in how up-to-date the data needs to be.

### Example Code

```sql
-- Create a dynamic table with a specified refresh frequency
CREATE OR REPLACE DYNAMIC TABLE my_dynamic_table
TARGET_LAG = '5 minutes' -- Set the refresh frequency to 5 minutes
  WAREHOUSE = mywh
  REFRESH_MODE = auto
  INITIALIZE = on_create
AS
SELECT
    column1,
    column2,
    column3
FROM
    source_table
```

## Setting Up Refresh Frequency Using `TARGET_LAG`

The `TARGET_LAG` parameter specifies the maximum allowable lag between the source data changes and the dynamic table updates. This allows you to balance between performance and data freshness.

In this example, the dynamic table `my_dynamic_table` will be refreshed every 5 minutes based on changes in the `source_table`.

Dynamic tables in Snowflake provide a robust solution for scenarios requiring near real-time data updates with efficient storage and customizable refresh frequencies.


## Refresh Mode of a Dynamic Table

The refresh mode of a dynamic table in Snowflake determines how the table updates its data based on changes in the source data. There are three refresh modes available: `auto`, `full refresh`, and `incremental refresh`.

### Auto Mode
- **Description**: In `auto` mode, Snowflake automatically determines the best way to refresh the dynamic table based on the source data changes.
- **Use Case**: This mode is suitable for most scenarios as it balances performance and data freshness without requiring manual intervention.

### Full Refresh
- **Description**: In `full refresh` mode, the entire dynamic table is refreshed by reprocessing all the data from the source table.
- **Use Case**: This mode is ideal when the source data undergoes significant changes, and a complete refresh is necessary to ensure data accuracy.

### Incremental Refresh
- **Description**: In `incremental refresh` mode, only the changes (inserts, updates, and deletes) in the source data since the last refresh are applied to the dynamic table.
- **Use Case**: This mode is best for scenarios where the source data changes incrementally, allowing for faster and more efficient updates.

### Choosing Between Refresh Modes
- **Auto Mode**: Choose this mode for general use cases where you want Snowflake to manage the refresh process efficiently.
- **Full Refresh**: Opt for this mode when the source data changes significantly, and you need to ensure the dynamic table reflects the entire dataset accurately.
- **Incremental Refresh**: Select this mode for scenarios with frequent, small changes to the source data, as it minimizes the refresh time and resource usage.


## Limitations of Dynamic Tables

It's important to note that we cannot directly insert, update, or delete records in a dynamic table. All changes to the data must come from the source table, and the dynamic table will reflect those changes based on the defined refresh frequency.