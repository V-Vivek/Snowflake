# Rejected Records

When working with data validation in Snowflake, you may encounter rejected records. These are records that do not meet the validation criteria specified in your queries. Snowflake provides functions to help you identify and analyze these rejected records.

## Using `RESULT_SCAN` with `LAST_QUERY_ID()`

You can use the `RESULT_SCAN` function along with `LAST_QUERY_ID()` to retrieve the results of the last query, which can be useful for analyzing rejected records. For example, if you have just run a validation query in `VALIDATION_MODE` with `RETURN_ERRORS`, you can retrieve the rejected records as follows:

```sql
-- The validation query will give all rejected records
COPY INTO my_table
FROM @my_stage
FILE_FORMAT = (TYPE = 'CSV')
PATTERN = '.*my_file.*'
VALIDATION_MODE = RETURN_ERRORS;

-- Creating the rejected table and inserting rejected_records in it
CREATE OR REPLACE TABLE myrejected_table AS
SELECT rejected_record FROM TABLE(RESULT_SCAN(LAST_QUERY_ID()));
```

## Using the `VALIDATE` Function

Alternatively, if you are not using `VALIDATION_MODE` you can use the `VALIDATE` function to validate your data and identify rejected records. The `_LAST` suffix can be used to refer to the last query executed. Here is an example using orders data:

```sql
-- Load data without validation
COPY INTO my_table
FROM @my_stage
FILE_FORMAT = (TYPE = 'CSV')
PATTERN = '.*my_file.*'
ON_ERROR = CONTINUE;

-- Extract rejected records using VALIDATE
CREATE OR REPLACE TABLE myrejected_table AS
SELECT * FROM TABLE(VALIDATE(my_table, job_id => '_LAST'));
```


## Processing Rejected Records

Once you have the rejected records in `myrejected_table`, you can process these records to extract specific values using the `SPLIT_PART` function.

```sql
-- Create a new table to store the extracted values
CREATE OR REPLACE TABLE myrejected_values AS
SELECT 
    SPLIT_PART(rejected_record, ',', 1) AS column1,
    SPLIT_PART(rejected_record, ',', 2) AS column2,
    SPLIT_PART(rejected_record, ',', 3) AS column3
FROM myrejected_table;
```

In this example, `SPLIT_PART` is used to split the `rejected_record` string by commas and extract the first three values into `column1`, `column2`, and `column3`. Adjust the number of columns and the delimiter as needed based on the structure of your rejected records.