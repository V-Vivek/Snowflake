## Data Insertion in Apache Iceberg

When you insert a record into an Apache Iceberg table, several operations occur to ensure data consistency and efficient querying. Here's a detailed explanation of what happens and which files are created or edited:


### Inserting 1st record
- A version-hint.txt file will be created which will point to the latest metadata file.
- A metadata json file will be created which contains the schema information, and other metada data info like, total records, no. of records added, no. of data files added, total data files size, etc. and it will point to the snapshot/manifest list file.
- A manifest list/snapshot file will be created which contains info like, no. of records added, no. of records deleted, partition information, etc. and it will point to the manifest file.
- A manifest file will be created which will holds the metadata about each table column and points to the data files.

### Inserting 2nd record
- The version-hint.txt file will point to the new metadata file.
- New metadata json file will be created
- New snapshot file will be created which will point to mainfest file of new record and also of old record.
- New manifest file will be create which contains metadata about new record and old record and it will point to the respective data files.
- One new data file will be created for the new record.

### Snapshot isolation
- Assume that there are 2 users. User1 is querying the iceberg table and User2 is inserting records in same table simultaenously.
- Now to avoid inconsistency and data loss Iceberg will create new metadata file for User2 but for User1 it will point to the old metadata file until the insert operation is completed by User2.
- Once the insert operation is completed the version-hint.txt file will point to the new metadata file.
- New snapshot file will be created which will point to mainfest file of new records and also of old records but it will be marked as deleted(soft delete)
- New manifest file will be create which contains metadata about new record and old record and it will point to the 2 newly created data files.
- 2 new data files will be created, 1 for the new record and one for the old record.
- The 1 old data file for old record will still remain in the data folder. hence there will be total 3 files prsent in the folder.
- This helps in snapshot isolation.



This structure ensures that Apache Iceberg can efficiently manage large datasets with ACID compliance, allowing for scalable and reliable data operations.