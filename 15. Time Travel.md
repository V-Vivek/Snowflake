# Time Travel in Snowflake

Snowflake's Time Travel feature allows you to access historical data at any point within a defined retention period. This can be useful for recovering from accidental data modifications or deletions.

## Query Historical Data

You can query historical data in Snowflake using the following methods:

### Using Timestamp
You can specify a timestamp to retrieve the state of the data at a particular point in time.
```sql
SELECT * FROM my_table AT (TIMESTAMP => '2023-10-01 12:00:00');
```

### Using Offset
You can specify an offset to retrieve the state of the data relative to the current time.
```sql
SELECT * FROM my_table AT (OFFSET => -60*24*7); -- 7 days ago
```

### Using Query ID
You can use a query ID to retrieve the state of the data as it was before a specific query was executed.
```sql
SELECT * FROM my_table BEFORE (STATEMENT => 'query_id');
```
## Table Data Recovery Using Historical Query

In some cases, you may need to recover table data using historical queries. The best method to achieve this is by restoring the data into a backup table, truncating the original table, and then inserting the data from the backup table.

### Steps to Recover Table Data

1. **Create a Backup Table**: Use a historical query to create a backup table with the desired state of the data.
    ```sql
    CREATE TABLE my_table_backup AS
    SELECT * FROM my_table AT (TIMESTAMP => '2023-10-01 12:00:00');
    ```

2. **Truncate the Original Table**: Remove all data from the original table to prepare for data restoration.
    ```sql
    TRUNCATE TABLE my_table;
    ```

3. **Insert Data from Backup Table**: Insert the data from the backup table into the original table.
    ```sql
    INSERT INTO my_table
    SELECT * FROM my_table_backup;
    ```

By following these steps, you can effectively recover table data using historical queries, ensuring that the original table is restored to its desired state.


## Recover Tables, Schema, and Database Using UNDROP

Snowflake allows you to recover dropped tables, schemas, and databases using the `UNDROP` command.

### Recover a Table
```sql
UNDROP TABLE my_table;
```

### Recover a Schema
```sql
UNDROP SCHEMA my_schema;
```

### Recover a Database
```sql
UNDROP DATABASE my_database;
```

## Set `DATA_RETENTION_TIME_IN_DAYS` for a New Table

You can set the data retention period for a new table to specify how long historical data should be retained.
```sql
CREATE TABLE my_table (
    id INT,
    data STRING
)
DATA_RETENTION_TIME_IN_DAYS = 7;
```

## Alter `DATA_RETENTION_TIME_IN_DAYS` for an Existing Table

You can alter the data retention period for an existing table.
```sql
ALTER TABLE my_table SET DATA_RETENTION_TIME_IN_DAYS = 7;
```

Time Travel in Snowflake provides powerful capabilities to manage and recover historical data, ensuring data integrity and availability.

## Time Travel and Data Retention Periods by Snowflake Edition

Snowflake offers different Time Travel and data retention periods based on the edition of the service you are using. The retention period determines how long historical data is available for Time Travel operations.

### Standard Edition
- **Time Travel Period**: Up to 1 day
- **Data Retention Period**: 1 day

### Enterprise Edition
- **Time Travel Period**: Up to 90 days
- **Data Retention Period**: 1 day (default), configurable up to 90 days

### Business Critical Edition
- **Time Travel Period**: Up to 90 days
- **Data Retention Period**: 1 day (default), configurable up to 90 days

### Virtual Private Snowflake (VPS)
- **Time Travel Period**: Up to 90 days
- **Data Retention Period**: 1 day (default), configurable up to 90 days

### Additional Notes
- The data retention period can be configured at the table level using the `DATA_RETENTION_TIME_IN_DAYS` parameter.
- The maximum retention period for Time Travel is determined by the Snowflake edition and cannot exceed the limits specified above.

Understanding the Time Travel and data retention capabilities of your Snowflake edition is crucial for effective data management and recovery planning.