# Snowflake Tasks

## Use of Task
Tasks in Snowflake are used to automate the execution of SQL statements, including calling stored procedures. They can be scheduled to run at specific intervals or triggered by the completion of other tasks, enabling complex workflows.
## Syntax
To create a task in Snowflake, use the following syntax:
```sql
CREATE TASK my_task
    WAREHOUSE = my_warehouse
    SCHEDULE = 'USING CRON 0 9 * * * UTC'
AS
    CALL my_stored_procedure();
```

To create a task that executes a simple SQL insert query:
```sql
CREATE TASK insert_task
    WAREHOUSE = my_warehouse
    SCHEDULE = '1 MINUTE'
AS
    INSERT INTO my_table (column1, column2) VALUES ('value1', 'value2');
```

## RESUME & SUSPEND the Task
To resume a task:
```sql
ALTER TASK my_task RESUME;
```

To suspend a task:
```sql
ALTER TASK my_task SUSPEND;
```

## Schedule Using Time
To schedule a task using a specific time interval:
```sql
CREATE TASK my_task
    WAREHOUSE = my_warehouse
    SCHEDULE = '1 MINUTE'
AS
    CALL my_stored_procedure();
```

## Schedule Using Cron
To schedule a task using a cron expression:
```sql
CREATE TASK my_task
    WAREHOUSE = my_warehouse
    SCHEDULE = 'USING CRON 0 9 * * * UTC'
AS
    CALL my_stored_procedure();
```

## Tasks with Conditions
Snowflake tasks can also be created with conditions to execute only when certain criteria are met. This is useful for creating more dynamic and responsive workflows.

### Example
To create a task that only executes if a specific condition is met, you can use the `WHEN` clause. Here is an example:

```sql
CREATE TASK conditional_task
    WAREHOUSE = my_warehouse
    SCHEDULE = '1 HOUR'
    WHEN (EXISTS (SELECT 1 FROM my_table WHERE status = 'ready'))
AS
    CALL my_conditional_procedure();
```

In this example, the task `conditional_task` will only execute if there is at least one row in `my_table` where the `status` column has the value 'ready'.

## Tree of Tasks and Its Syntax
A tree of tasks allows you to create a hierarchy where tasks are dependent on the completion of other tasks. Here is an example:
```sql
CREATE TASK parent_task
    WAREHOUSE = my_warehouse
    SCHEDULE = '1 HOUR'
AS
    CALL parent_procedure();

CREATE TASK child_task
    WAREHOUSE = my_warehouse
    AFTER parent_task
AS
    CALL child_procedure();
```

## Task History
- The `information_schema.task_history` table provides a detailed log of task executions in Snowflake.
- It contains information about the status, start time, end time, and other relevant details of each task execution.

 ```sql
 SELECT * FROM TABLE 
 (
    information_schema.task_history
    (
        task_name => 'my_task'
    )
);
 ```
 * This query retrieves the execution history of a specific task, ordered by the most recent executions.
 */